<!DOCTYPE html>
<div class="entry-content">
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://www.youtube.com/iframe_api"></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
<title>Sim Assist</title>
<style>
:root {
--dark: #05152E;
--darker: #1F2937;
--darkest: #001E3C;
--grey: #6B7280;
--pink: #EC4899;
--purple: #8B5CF6;
--light: #EEE;
--black: #333;
}
.sim-assist {
    background-color: #0a0e14;
    padding: 2rem;
    color: rgba(255, 255, 255, .8);
}
/* Add your styles for the buttons here */
.entry-content .sim-assist button, .entry-content .sim-assist input[type=button] {
    padding: 10px 20px;
    background-color: #000;
    color: white;
    border: none;
    border-radius: 5px;
    font-size: 16px;
    cursor: pointer;
    text-transform: none;
    letter-spacing: normal;
    line-height: 1;
    transition: 0.4s;
    font-size: 1rem;
    font-weight: normal;
    margin-bottom: 0 !important;
}
.entry-content .sim-assist button.green, .entry-content .sim-assist button.btn-success {
    color: white;
    background-color: green;
}
.entry-content .sim-assist button.yellow, .entry-content .sim-assist button.btn-warning {
    color: white;
    background-color: #e0a800;
}
.entry-content .sim-assist button.red, .entry-content .sim-assist button.btn-danger {
    color: white;
    background-color: red;
}
* {
    margin: 0;
    box-sizing: border-box;
    font-family: "Fira sans", sans-serif;
}
.entry-content body {
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    color: #FFF;
    background-color: var(--darkest);
}
.entry-content header {
    padding: 2rem 1rem;
    max-width: 800px;
    width: 100%;
    margin: 0 auto;
}
.entry-content header h1 {
    font-size: 2.5rem;
    font-weight: 300;
    color: white;
    margin: 0;
}
.entry-content h1 {
    text-align: center;
}
#new-task-form {
    display: flex;
    align-items: center;
    width: 100%;
    margin-bottom: 2rem;
}
input#video-link {
    width: 100%;
}
.entry-content input, .entry-content button {
    appearance: none;
    border: none;
    outline: none;
    background: none;
}
#new-task-input {
    flex: 1 1 0%;
    background-color: var(--darker);
    padding: 1rem;
    border-radius: 1rem;
    margin-right: 1rem;
    color: var(--light);
    font-size: 1.25rem;
}
#new-task-input::placeholder {
color: var(--grey);
}
#new-task-submit {
    background: #3952b1;
}
#new-task-submit:hover {
    opacity: 0.8;
}
#new-task-submit:active {
    opacity: 0.6;
}
#new-comment-submit {
    display: block;
}
#new-comment-submit:hover {
    opacity: 0.8;
}
#new-comment-submit:active {
    opacity: 0.6;
}
form#comment-form #new-comment-input {
    width: 100%;
}
.entry-content main {
    flex: 1 1 0%;
    max-width: 800px;
    width: 100%;
    margin: 0 auto;
}
.task-list {
    border-radius: 5px;
    background-color: var(--darker);
    padding: 1rem;
}
.data-table h2 {
    font-size: 1.5rem;
    font-weight: 300;
    color: var(--grey);
    margin-bottom: 1rem;
}
section.stopwatch {
    display: flex;
    align-items: flex-start;
    justify-content: flex-start;
}
section.stopwatch > * {
    margin-left: 1%;
}
section.stopwatch > :first-child {
    margin-right: 2%;
    margin-left: 0;
}
#stopwatch-time-input {
    color: white;
}
.stopwatch-button {
    background-color: #3399ff;
}
.stopwatch-button:hover {
    background-color: #0066cc;
}
.stopwatch-button:active {
    background-color: #003399;
}

@media only screen and (max-width: 800px) {
	section.stopwatch {
    	flex-wrap: wrap;
	}
}
#tasks .task {
    display: flex;
    justify-content: space-between;
    background-color: var(--darkest);
    padding: 1rem;
    border-radius: 1rem;
    margin-bottom: 1rem;
}
.task .content {
    flex: 1 1 0%;
}
.task .content .text {
    color: var(--light);
    font-size: 1.125rem;
    width: 100%;
    display: block;
    transition: 0.4s;
}
.task .content .text:not(:read-only) {
    color: var(--pink);
}
.task .actions {
    display: flex;
    flex-wrap: nowrap;
}
.task .actions button {
    margin: 0 2%;
    font-size: .8rem;
    flex: 1 1 0;
    padding: 0.5rem;
    min-width: 3.5rem;
}
.task .actions button:hover {
    opacity: 0.8;
}
.task .actions button:active {
    opacity: 0.6;
}
.task .actions .edit {
    background-image: linear-gradient(to right, var(--pink), var(--purple));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}
.task .actions .delete {
    color: crimson;
}
.entry-content table {
    border-collapse: collapse;
    width: 100%;
}
.entry-content th, .entry-content td {
    text-align: left;
    padding: 8px;
    border-bottom: 1px solid #ddd;
}
tr:nth-child(even) {
    background-color: var(--darker);
    color: white;
}
th {
    background-color: ##8b8f8b;
    color: white;
}
.embed-responsive {
    background: black;
    margin-bottom: 20px;
}
#video-form {
    display: flex;
    align-items: center;
    justify-content: flex-start;
    width: 100%;
    margin-bottom: 2rem;
}
#video-form .form-group {
    min-width: calc(100% - 10rem);
    margin: 0!important;
}
#video-link {
    padding: 10px;
    font-size: 18px;
    border: none;
    border-radius: 5px;
    margin-right: 10px;
    background-color: var(--darker);
    color: var(--light);
    font-size: 1.25rem;
}
button#submit-video {
    background-color: #4CAF50;
}
button#submit-video:hover {
    background-color: #3e8e41;
}
#export-button {
/*    background-color: blue;*/
}
.two-columns {
    display: flex;
    flex-wrap: nowrap;
}
.two-columns .column:first-child {
    width: 48%;
    margin-right: 2%;
}
.two-columns .column:last-child {
    width: 48%;
    margin-left: 2%;
}
</style>
</head>
<body>
<div class="sim-assist">
  <header>
    <h1>Sim Assist</h1>
  </header>
  <main>
    <div class="embed-responsive embed-responsive-16by9" id="player"></div>
    <p class="instructions">Enter Link to Video:</p>
    <form class="form-inline" id="video-form">
      <div class="form-group mx-sm-3 mb-2">
        <label for="video-link" class="sr-only">Enter YouTube Video Link:</label>
        <input type="text" class="form-control" id="video-link" placeholder="https://www.youtube.com/watch?v=XR0E4XiQwdM">
      </div>
      <button id="submit-video" type="submit" class="btn btn-primary mb-2">Load Video</button>
    </form>
    <section class="stopwatch">
      <p class="instructions"> If you'd like to run your own stopwatch, you may do so here.</p>
      <p class="instructions">StopWatch:</p>
      <input type="button" class="stopwatch-button" id="stopwatch-start" value="Start" onclick="startStopwatch()">
      <input type="button" class="stopwatch-button" id="stopwatch-stop" value="Stop" onclick="stopStopwatch()">
      <input type="text" id="stopwatch-time-input" value="00:00:00">
    </section>
    <hr/>
    <h2>Observe and Record</h2>
    <p class="instructions"> Enter a list of tasks or skills you'd like to observe and record. Watch the video and annotate events using the buttons below. Make any comments you'd like to add.</p>
    <p class="instructions">Key: Green=Advanced, Yellow=Intermediate, Red=Beginner</p>
    <form id="new-task-form">
      <input type="text" id="new-task-input" placeholder="Enter a task or skill to observe">
      <button id="new-task-submit" type="submit">Add Task</button>
    </form>
    <div class="two-columns">
      <div class="column">
        <!--Task Table-->
        <section class="task-list">
          <div id="tasks"> </div>
        </section>
      </div>
      <div class="column">
        <!-- Form for user to input comment -->
        <form id="comment-form">
          <textarea id="new-comment-input" placeholder="Enter a comment"></textarea>
          <button class="button" id="new-comment-submit" type="submit">Add Comment</button>
        </form>
        <!-- Comment Table -->
        <section class="comment-table">
          <!--  <h2>Comment Table</h2>-->
          <table id="comment-table">
            <thead>
              <tr>
                <th>Comment</th>
                <th>Timestamp</th>
                <th>Video Time</th>
              </tr>
            </thead>
            <tbody id="comment-table-body">
            </tbody>
          </table>
        </section>
      </div>
    </div>
    <section class="data-table">
      <h2>Data Table</h2>
      <table id="task-table">
        <thead>
          <tr>
            <th>Task</th>
            <th>Level</th>
            <th>Timestamp</th>
            <th>Stopwatch</th>
            <th>Video Time</th>
          </tr>
        </thead>
        <tbody id="task-table-body">
        </tbody>
      </table>
    </section>
    <button id="export-button" onclick="exportTableToCSV()">Export as CSV</button>
  </main>
</div>
</body>
</html>
</div>
<script>
 // Get reference to the form and button
  const commentForm = document.getElementById("comment-form");
  const newCommentSubmit = document.getElementById("new-comment-submit");

  // Add event listener for when the form is submitted
  commentForm.addEventListener("submit", (event) => {
    event.preventDefault();

    // Get the user's comment, the current time and the current video time
    const comment = document.getElementById("new-comment-input").value;
    const timestamp = new Date().toLocaleString();
    const videoTime = player.getCurrentTime();

    // Create a new row in the Comment Table
    const newRow = document.createElement("tr");
    const commentCell = document.createElement("td");
    const timestampCell = document.createElement("td");
    const videoTimeCell = document.createElement("td");

    commentCell.innerHTML = comment;
    timestampCell.innerHTML = timestamp;
    videoTimeCell.innerHTML = videoTime;
    newRow.appendChild(commentCell);
    newRow.appendChild(timestampCell);
    newRow.appendChild(videoTimeCell);

    // Add the new row to the Comment Table
    const commentTableBody = document.getElementById("comment-table-body");
    commentTableBody.appendChild(newRow);

    // Clear the input field
    document.getElementById("new-comment-input").value = "";
  });
//let currentTime = 0;
//setInterval(() => {
//  currentTime++;
//}, 1000);

	// Inserts youtube video at the top of the page
  var player;
 function onYouTubeIframeAPIReady() {
  player = new YT.Player('player', {
    height: '360',
    width: '640',
    videoId: 'XR0E4XiQwdM', // Replace with the video ID
    playerVars: {
      'autoplay': 0 // Set autoplay to 0 to prevent the video from playing automatically
    },
    events: {
      'onReady': onPlayerReady,
      'onStateChange': onPlayerStateChange
    }
  });
}

  
  let currentTime = 0;
setInterval(() => {
  currentTime = player.getCurrentTime();
}, 1000);

function updateTimeInTable() {
    let timeCell = document.getElementById("time-cell");
    timeCell.innerHTML = player.getCurrentTime();
}



   function onPlayerReady(event) {
    event.target.playVideo();
    player = event.target;
    player.pauseVideo(); 
    updateTimeInTable();
  }

  
 // In onPlayerStateChange
function onPlayerStateChange(event) {
    if(event.data === YT.PlayerState.PLAYING) {
        currentTime = player.getCurrentTime();
        let timeInSeconds = currentTime;
        let date = new Date(timeInSeconds * 1000);
        let formattedTime = date.toLocaleTimeString('en-US', {
            hour12: false, 
            hour: "2-digit", 
            minute: "2-digit", 
            second: "2-digit" 
        });
        document.getElementById("time-cell").innerHTML = "Video Time";
        document.getElementById("time-cell").innerHTML = formattedTime;
    }
}
















  
var videoForm = document.getElementById("video-form");
var videoLink = document.getElementById("video-link");

videoForm.addEventListener("submit", function(event) {
    event.preventDefault();
    var url = videoLink.value;
    var videoId = url.split("v=")[1];
    console.log(videoId); // Output: "dQw4w9WgXcQ"

    // use the videoId to load the video using the YouTube iFrame API
    // replace the hardcoded videoId in the onYouTubeIframeAPIReady function with the videoId
    player.loadVideoById({'videoId': videoId});
});

	
  `let stopwatch = 0;`


function startStopwatch() {
  let seconds = 0;
  let minutes = 0;
  let hours = 0;

  stopwatchInterval = setInterval(function() {
    seconds++;
    if (seconds === 60) {
      seconds = 0;
      minutes++;
    }
    if (minutes === 60) {
      minutes = 0;
      hours++;
    }

    const formattedSeconds = seconds < 10 ? "0" + seconds : seconds;
    const formattedMinutes = minutes < 10 ? "0" + minutes : minutes;
    const formattedHours = hours < 10 ? "0" + hours : hours;
    const stopwatchTime = `${formattedHours}:${formattedMinutes}:${formattedSeconds}`;

   $("#stopwatch-time").text(stopwatchTime);  // update the text content of the div element
    document.getElementById("stopwatch-time-input").value = stopwatchTime;  // update the value of the input element
  }, 1000);  // update the stopwatch time every 1000 milliseconds (1 second)
}

function stopStopwatch() {
  clearInterval(stopwatchInterval);
  $("#stopwatch-time").text("00:00:00");  // reset the stopwatch time
  document.getElementById("stopwatch-time-input").value = $("#stopwatch-time").text();
}

  var stopwatch = 0; // Initialize the stopwatch to 0


function addTimeToTable() {
    var currentTime = player.getCurrentTime();
    currentTime = currentTime.toFixed(2);
    // Get the task name from the input field
    var taskName = document.querySelector('#new-task-input').value;

    // Find the table
    var table = document.querySelector('table');

    // Add a new row to the table
    var newRow = table.insertRow(-1);

    // Add a new cell with the task name to the new row
    var taskCell = newRow.insertCell(-1);
    taskCell.innerHTML = taskName;

    // Add a new cell with the current video time to the new row
    var timeCell = newRow.insertCell(-1);
    timeCell.innerHTML = currentTime;
  }



// function updateTimeInTable(event) {
 //   if(event.data === 0) {
//        console.log("Video ended");
 //   }
 //   timeCell.innerHTML = stopwatch;
 //   videoTimeCell.innerHTML = player.getCurrentTime();
 // }



  function resetStopwatch() {
    stopwatch = 0;
  }


const taskForm = document.querySelector("#new-task-form");
  const taskInput = document.querySelector("#new-task-input");
  const taskList = document.querySelector("#tasks");
  const taskTable = document.querySelector("#task-table");
  const stopwatchTime = document.querySelector("#stopwatch-time-input").value;


  taskForm.addEventListener("submit", e => {
    e.preventDefault();

    // get the task name
    const taskName = taskInput.value;

    // create the task element
    const taskEl = document.createElement("div");
    taskEl.classList.add("task");
    taskEl.innerHTML = `
      <div class="content">
        <span class="text">${taskName}</span>
      </div>
      <div class="actions">

	<button class="btn btn-success">Green</button>
    <button class="btn btn-warning">Yellow</button>
    <button class="btn btn-danger">Red</button>
	
	
      </div>
	`;

function addTaskToTable(taskName, color, stopwatchTime) {
  // get the current date and time
  const dateTime = new Date().toLocaleString();

  // create a new row in the table
  const newRow = taskTable.insertRow();

  // insert cells in the row
  const taskNameCell = newRow.insertCell(0);
  const colorCell = newRow.insertCell(1);
  const dateTimeCell = newRow.insertCell(2);
  const stopwatchTimeCell = newRow.insertCell(3);  // add a new cell for the stopwatch time
  const currentTimeCell = newRow.insertCell(4);

  // fill the cells with data
  taskNameCell.innerHTML = taskName;
  colorCell.innerHTML = color;
  dateTimeCell.innerHTML = dateTime;
  stopwatchTimeCell.innerHTML = stopwatchTime;  // set the stopwatch time in the new cell
  currentTimeCell.innerHTML = currentTime;
}

    // add event listeners to the buttons
 taskEl.querySelector(".btn-success").addEventListener("click", () => addTaskToTable(taskName, "green", document.getElementById("stopwatch-time-input").value, currentTime));
taskEl.querySelector(".btn-warning").addEventListener("click", () => addTaskToTable(taskName, "yellow", document.getElementById("stopwatch-time-input").value, currentTime));
taskEl.querySelector(".btn-danger").addEventListener("click", () => addTaskToTable(taskName, "red", document.getElementById("stopwatch-time-input").value, currentTime));


document.getElementById("new-task-submit").removeEventListener("click", addTaskToTable);

    // append the task element to the task list
    taskList.appendChild(taskEl);

    // reset the form
    taskForm.reset();
  });

  





function addTask() {
  //get the task name and color from the form
  const taskName = $("#new-task-input").val();
  const color = $(this).attr("class");
  stopwatch++;
  // add the task to the table
  addTaskToTable(taskName, color, stopwatch, currentTime);
  // clear the input field and set the focus back to it
  $("#new-task-input").val("").focus();
}


$(".green").click(addTask);
$(".yellow").click(addTask);
$(".red").click(addTask);

$(".green").click(() => addTaskToTable(taskName, "green", $("#stopwatch-time-input").val(), currentTime));
$(".yellow").click(() => addTaskToTable(taskName, "yellow", $("#stopwatch-time-input").val()));
$(".red").click(() => addTaskToTable(taskName, "red", $("#stopwatch-time-input").val()));



// add the task to the table
  addTaskToTable(taskName, color, stopwatchTime, currentTime);







  // Create listener for CSV button 
   document.getElementById("export-button").addEventListener("click", function() {
    // Select the table rows
    var rows = document.querySelectorAll("table tr");

    // Create a CSV string
    var csv = "";
    rows.forEach(function(row) {
      var cells = row.querySelectorAll("td, th");
      csv += cells.map(function(cell) {
        return cell.textContent.replace(/,/g, "|");
      }).join(",");
      csv += "\n";
    });

    // Download the CSV file
    var link = document.createElement("a");
    link.href = "data:text/csv;charset=utf-8," + encodeURIComponent(csv);
    link.download = "table-data.csv";
    link.click();
  });
  
  function exportTableToCSV() {
  // Get the table data
  const rows = document.querySelectorAll("table tr");
  let csv = "";
  
  // Loop through the rows and add the data to the CSV string
  for (const row of rows) {
    const data = row.querySelectorAll("td, th");
    let rowData = "";
    for (const cell of data) {
      rowData += `"${cell.textContent}",`;
    }
    csv += `${rowData}\n`;
  }
  
  // Download the CSV file
  const link = document.createElement("a");
  link.setAttribute("href", "data:text/csv;charset=utf-8," + encodeURIComponent(csv));
  link.setAttribute("download", "table-data.csv");
  link.style.display = "none";
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}

</script>